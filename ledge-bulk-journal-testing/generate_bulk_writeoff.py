#!/usr/bin/env python3
"""
Generate bulk journal CSV test data for crypto write-offs.

Usage:
    # Generate 10k balanced entries (happy path)
    python scripts/generate_bulk_writeoff.py --entries 10000 --output test_writeoff.csv

    # Generate 500k entries for scale testing
    python scripts/generate_bulk_writeoff.py --entries 500000 --output large_writeoff.csv

    # Generate unbalanced entries (error scenario - DR != CR)
    python scripts/generate_bulk_writeoff.py --entries 1000 --unbalanced --output error_test.csv

    # Use account pairs from same asset instead of write-off accounts
    python scripts/generate_bulk_writeoff.py --entries 1000 --no-writeoff-accounts --output inter_account.csv

    # Specify accounting date
    python scripts/generate_bulk_writeoff.py --entries 1000 --date 2026-01-15 --output dated_test.csv
"""

import csv
import random
import argparse
from decimal import Decimal
from datetime import date
from typing import List, Tuple, Dict
from collections import defaultdict

# =============================================================================
# STAGING DATA - From Query 2 results (SUB_ACCT, NATURAL_ACCT, ASSET_ID)
# Grouped by ASSET_ID for pairing accounts with the same asset
# =============================================================================

RAW_DATA = """BR00144R7USD,000000,00000000000000026258
BR00145R6USD,000000,00000000000000026258
BR00161X2CAD,000000,00000000000000026258
BR00161X2CAD,201110,00000000000000026258
HD8500104CAD,000000,00000000000000026258
HD8500401CAD,000000,00000000000000026258
HQ04X3S05CAD,000000,00000000000000026258
HQ05LN209CAD,000000,00000000000000026258
HQ0N5TW10CAD,000000,00000000000000026258
TO0002006CAD,000000,00000000000000026258
TO0003803CAD,000000,00000000000000026258
BR00037W6CAD,000000,00000000000000026242
BR00040R2CAD,000000,00000000000000026242
BR00135L1USD,000000,00000000000000026242
BR00136L0USD,000000,00000000000000026242
HQ011XM14CAD,000000,00000000000000026242
HQ015R819CAD,000000,00000000000000026242
HQ01Q1912CAD,000000,00000000000000026242
BR00135L1USD,000000,00000000000000026261
BR00136L0USD,000000,00000000000000026261
BR00142X6USD,120325,00000000000000026261
BR00144R7USD,000000,00000000000000026261
BR00145R6USD,000000,00000000000000026261
BR00149W1USD,000000,00000000000000026261
BR00149W1USD,201120,00000000000000026261
BR00153R5USD,000000,00000000000000026261
BR00156W1USD,000000,00000000000000026261
BR0017205USD,000000,00000000000000026261
H63496519CAD,000000,00000000000000026261
HQ00QYR12CAD,000000,00000000000000026261
HQ00ZZZ10CAD,000000,00000000000000026261
HQ011XM14CAD,000000,00000000000000026261
HQ01F5S14CAD,000000,00000000000000026261
HQ01Q1912CAD,000000,00000000000000026261
HQ01TRZ13CAD,000000,00000000000000026261
HQ01YS617CAD,000000,00000000000000026261
HQ01Z5Q14CAD,000000,00000000000000026261
HQ022J818CAD,000000,00000000000000026261
HQ02CCT19CAD,000000,00000000000000026261
HQ02CPF15CAD,000000,00000000000000026261
HQ02CYF16CAD,000000,00000000000000026261
HQ02GXW15CAD,000000,00000000000000026261
HQ02NYC17CAD,000000,00000000000000026261
HQ04CLS16CAD,000000,00000000000000026261
HQ04L2M14CAD,000000,00000000000000026261
HQ04Q9R19CAD,000000,00000000000000026261
HQ051B611CAD,000000,00000000000000026261
HQ054JX11CAD,000000,00000000000000026261
HQ0573L16CAD,000000,00000000000000026261
HQ05JP215CAD,000000,00000000000000026261
HQ05RVR16CAD,000000,00000000000000026261
HQ05RZK14CAD,000000,00000000000000026261
HQ05S6M15CAD,000000,00000000000000026261
HQ05VJC14CAD,000000,00000000000000026261
HQ063DL16CAD,000000,00000000000000026261
HQ06KB410CAD,000000,00000000000000026261
HQ07FQK13CAD,000000,00000000000000026261
HQ07FZM11CAD,000000,00000000000000026261
HQ0QV8R16CAD,000000,00000000000000026261
X1000SK17CAD,000000,00000000000000026261
X1000TL14CAD,000000,00000000000000026261
BR00135L1USD,000000,00000000000000026236
BR00136L0USD,000000,00000000000000026236
BR00142X6USD,000000,00000000000000026236
BR00142X6USD,120325,00000000000000026236
BR00143R8USD,000000,00000000000000026236
BR00144R7USD,000000,00000000000000026236
BR00145R6USD,000000,00000000000000026236
BR00148W2USD,000000,00000000000000026236
BR00149W1USD,000000,00000000000000026236
BR00149W1USD,201120,00000000000000026236
BR00164L5USD,000000,00000000000000026236
BR00190X7USD,000000,00000000000000026236
BR00190X7USD,120325,00000000000000026236
H63496519CAD,000000,00000000000000026236
H63496519CAD,201010,00000000000000026236
HQ011XM14CAD,000000,00000000000000026236
HQ015R819CAD,000000,00000000000000026236
HQ01B2C12CAD,000000,00000000000000026236
HQ01F5S14CAD,000000,00000000000000026236
HQ01Q1912CAD,000000,00000000000000026236
HQ01WRF11CAD,000000,00000000000000026236
HQ01YS617CAD,000000,00000000000000026236
HQ022J818CAD,000000,00000000000000026236
HQ023N016CAD,000000,00000000000000026236
HQ023TX17CAD,000000,00000000000000026236
HQ0243B17CAD,000000,00000000000000026236
HQ0244B15CAD,000000,00000000000000026236
HQ0246J12CAD,000000,00000000000000026236
HQ0247S10CAD,000000,00000000000000026236
HQ026ZM12CAD,000000,00000000000000026236
HQ027MC11CAD,000000,00000000000000026236
HQ027MF18CAD,000000,00000000000000026236
HQ027MH16CAD,000000,00000000000000026236
HQ028W912CAD,000000,00000000000000026236
HQ029T215CAD,000000,00000000000000026236
HQ02CCT19CAD,000000,00000000000000026236
HQ02CPF15CAD,000000,00000000000000026236
HQ02CYF16CAD,000000,00000000000000026236
HQ02DQ414CAD,000000,00000000000000026236
HQ02GXW15CAD,000000,00000000000000026236
HQ02QCD11CAD,000000,00000000000000026236
HQ0353610CAD,000000,00000000000000026236
HQ04CLS16CAD,000000,00000000000000026236
HQ04L7B15CAD,000000,00000000000000026236
HQ04MJR11CAD,000000,00000000000000026236
HQ04NCC11CAD,000000,00000000000000026236
HQ04NTT16CAD,000000,00000000000000026236
HQ04Q9R19CAD,000000,00000000000000026236
HQ04YH516CAD,000000,00000000000000026236
HQ0534C18CAD,000000,00000000000000026236
HQ053PK12CAD,000000,00000000000000026236
HQ0543D18CAD,000000,00000000000000026236
HQ054JX11CAD,000000,00000000000000026236
HQ0573L16CAD,000000,00000000000000026236
HQ05D6R16CAD,000000,00000000000000026236
HQ05KFS17CAD,000000,00000000000000026236
HQ05PKY14CAD,000000,00000000000000026236
HQ05Q8G10CAD,000000,00000000000000026236
HQ05QLY11CAD,000000,00000000000000026236
HQ05QML13CAD,000000,00000000000000026236
HQ05QPF13CAD,000000,00000000000000026236
HQ05R5J12CAD,000000,00000000000000026236
HQ05RLL14CAD,000000,00000000000000026236
HQ05RVJ15CAD,000000,00000000000000026236
HQ05RVR16CAD,000000,00000000000000026236
HQ05RZK14CAD,000000,00000000000000026236
HQ05RZN11CAD,000000,00000000000000026236
HQ05S6M15CAD,000000,00000000000000026236
HQ05T5X14CAD,000000,00000000000000026236
HQ05TPQ18CAD,000000,00000000000000026236
HQ05VJC14CAD,000000,00000000000000026236
HQ05Z0212CAD,000000,00000000000000026236
HQ060QQ15CAD,000000,00000000000000026236
HQ061C211CAD,000000,00000000000000026236
HQ0627Y16CAD,000000,00000000000000026236
HQ062Q318CAD,000000,00000000000000026236
HQ0637715CAD,000000,00000000000000026236
HQ063CB19CAD,000000,00000000000000026236
HQ063DL16CAD,000000,00000000000000026236
HQ064Q613CAD,000000,00000000000000026236
HQ065C712CAD,000000,00000000000000026236
HQ069H311CAD,000000,00000000000000026236
HQ069LV11CAD,000000,00000000000000026236
HQ069TH10CAD,000000,00000000000000026236
HQ069ZQ16CAD,000000,00000000000000026236
HQ06B0T17CAD,000000,00000000000000026236
HQ06B0Y11CAD,000000,00000000000000026236
HQ06C3J11CAD,000000,00000000000000026236
HQ06CDS19CAD,000000,00000000000000026236
HQ06DG615CAD,000000,00000000000000026236
HQ06K9118CAD,000000,00000000000000026236
HQ06KB410CAD,000000,00000000000000026236
HQ06L2Y16CAD,000000,00000000000000026236
HQ072XP17CAD,000000,00000000000000026236
HQ0761Z12CAD,000000,00000000000000026236
HQ07FMY17CAD,000000,00000000000000026236
HQ07FQK13CAD,000000,00000000000000026236
HQ07FZM11CAD,000000,00000000000000026236
HQ07N8P19CAD,000000,00000000000000026236
HQ08LSS12CAD,000000,00000000000000026236
HQ08Y9G13CAD,000000,00000000000000026236
HQ0D2NN18CAD,000000,00000000000000026236
HQ0D9RH19CAD,000000,00000000000000026236
HQ0DL7S17CAD,000000,00000000000000026236
HQ0HM8B13CAD,000000,00000000000000026236
HQ0P91Y10CAD,000000,00000000000000026236
HQ0P97915CAD,000000,00000000000000026236
HQ0PZHQ15CAD,000000,00000000000000026236
HQ0QN6N13CAD,000000,00000000000000026236
HQ0QQPQ15CAD,000000,00000000000000026236
HQ0QV8R16CAD,000000,00000000000000026236
HQ0RY1916CAD,000000,00000000000000026236
HQ0RY1D11CAD,000000,00000000000000026236
HQ0RZDR19CAD,000000,00000000000000026236
HQ0SN7Z14CAD,000000,00000000000000026236
HQ0T7WX17CAD,000000,00000000000000026236
HQ0TT6Z18CAD,000000,00000000000000026236
HQ0V6QP15CAD,000000,00000000000000026236
HQ0V6VD17CAD,000000,00000000000000026236
HQ0ZL0617CAD,000000,00000000000000026236
HQ0ZNR913CAD,000000,00000000000000026236
HQ10XWY19CAD,000000,00000000000000026236
HQ11MYR13CAD,000000,00000000000000026236
HQ11MYV18CAD,000000,00000000000000026236
HQ11MYX16CAD,000000,00000000000000026236
HQ11VBT11CAD,000000,00000000000000026236
HQ12B4R19CAD,000000,00000000000000026236
HQ12B6S13CAD,000000,00000000000000026236
HQ12BKZ14CAD,000000,00000000000000026236
HQ132LY11CAD,000000,00000000000000026236
HQ140LS18CAD,000000,00000000000000026236
HQ14MB214CAD,000000,00000000000000026236
HQ164XY16CAD,000000,00000000000000026236
HQ1813810CAD,000000,00000000000000026236
HQ1813R19CAD,000000,00000000000000026236
HQ1815112CAD,000000,00000000000000026236
HQ1817J19CAD,000000,00000000000000026236
HQ18N9W16CAD,000000,00000000000000026236
HQ195MJ10CAD,000000,00000000000000026236
HQ19HTQ14CAD,000000,00000000000000026236
HQ1B9D417CAD,000000,00000000000000026236
HQ1C17317CAD,000000,00000000000000026236
HQ1CJ2C19CAD,000000,00000000000000026236
HQ1CKQ918CAD,000000,00000000000000026236
HQ1DQK111CAD,000000,00000000000000026236
HQ1DT2G12CAD,000000,00000000000000026236
X10003717CAD,000000,00000000000000026236
X10008K11CAD,000000,00000000000000026236
X10008L10CAD,000000,00000000000000026236
X10008L10CAD,201010,00000000000000026236
X1000SK17CAD,000000,00000000000000026236
X1000TL14CAD,000000,00000000000000026236
BR00135L1USD,000000,00000000000000026237
BR00136L0USD,000000,00000000000000026237
BR00142X6USD,000000,00000000000000026237
BR00142X6USD,120325,00000000000000026237
BR00142X6USD,201120,00000000000000026237
BR00143R8USD,000000,00000000000000026237
BR00144R7USD,000000,00000000000000026237
BR00145R6USD,000000,00000000000000026237
BR00149W1USD,000000,00000000000000026237
BR00149W1USD,201120,00000000000000026237
BR00152R6USD,000000,00000000000000026237
BR00153R5USD,000000,00000000000000026237
BR00164L5USD,000000,00000000000000026237
BR0017205USD,000000,00000000000000026237
BR00176R8USD,000000,00000000000000026237
BR00184R8USD,000000,00000000000000026237
BR00189X0USD,000000,00000000000000026237
BR00189X0USD,120325,00000000000000026237
BR00189X0USD,201120,00000000000000026237
BR00271W9USD,000000,00000000000000026237
BR00273R0USD,000000,00000000000000026237
H63496519CAD,000000,00000000000000026237
H82820111CAD,000000,00000000000000026237
HQ011XM14CAD,000000,00000000000000026237
HQ015R819CAD,000000,00000000000000026237
HQ01B2C12CAD,000000,00000000000000026237
HQ01CMM16CAD,000000,00000000000000026237
HQ01F5S14CAD,000000,00000000000000026237
HQ01GQS17CAD,000000,00000000000000026237
HQ01L1J16CAD,000000,00000000000000026237
HQ01M0Y10CAD,000000,00000000000000026237
HQ01N7417CAD,000000,00000000000000026237
HQ01NJG18CAD,000000,00000000000000026237
HQ01Q1912CAD,000000,00000000000000026237
HQ01RR112CAD,000000,00000000000000026237
HQ01S4B11CAD,000000,00000000000000026237
HQ01TRZ13CAD,000000,00000000000000026237
HQ01TS811CAD,000000,00000000000000026237
HQ01XK813CAD,000000,00000000000000026237
HQ01YS617CAD,000000,00000000000000026237
HQ01Z5Q14CAD,000000,00000000000000026237
HQ020N415CAD,000000,00000000000000026237
HQ022J818CAD,000000,00000000000000026237
HQ0246J12CAD,000000,00000000000000026237
HQ0247S10CAD,000000,00000000000000026237
HQ024YP14CAD,000000,00000000000000026237
HQ024YS11CAD,000000,00000000000000026237
HQ025VG19CAD,000000,00000000000000026237
HQ026ZM12CAD,000000,00000000000000026237
HQ027MC11CAD,000000,00000000000000026237
HQ027MH16CAD,000000,00000000000000026237
HQ0289T11CAD,000000,00000000000000026237
HQ028W912CAD,000000,00000000000000026237
HQ029T215CAD,000000,00000000000000026237
HQ02CCT19CAD,000000,00000000000000026237
HQ02CPF15CAD,000000,00000000000000026237
HQ02CYF16CAD,000000,00000000000000026237
HQ02DX310CAD,000000,00000000000000026237
HQ02GX713CAD,000000,00000000000000026237
HQ02GXW15CAD,000000,00000000000000026237
HQ02H5M16CAD,000000,00000000000000026237
HQ02NYC17CAD,000000,00000000000000026237
HQ030M514CAD,000000,00000000000000026237
HQ034CJ17CAD,000000,00000000000000026237
HQ03PT413CAD,000000,00000000000000026237
HQ03PTD13CAD,000000,00000000000000026237
HQ04CLS16CAD,000000,00000000000000026237
HQ04CM212CAD,000000,00000000000000026237
HQ04GTC12CAD,000000,00000000000000026237
HQ04L2M14CAD,000000,00000000000000026237
HQ04NCC11CAD,000000,00000000000000026237
HQ04NTT16CAD,000000,00000000000000026237
HQ04Q9R19CAD,000000,00000000000000026237
HQ04T9015CAD,000000,00000000000000026237
HQ04V7818CAD,000000,00000000000000026237
HQ04W8F17CAD,000000,00000000000000026237
HQ0501Y13CAD,000000,00000000000000026237
HQ050YN13CAD,000000,00000000000000026237
HQ0512215CAD,000000,00000000000000026237
HQ051B611CAD,000000,00000000000000026237
HQ0532X19CAD,000000,00000000000000026237
HQ0573L16CAD,000000,00000000000000026237
HQ05D6R16CAD,000000,00000000000000026237
HQ05FJ510CAD,000000,00000000000000026237
HQ05H2010CAD,000000,00000000000000026237
HQ05H5M19CAD,000000,00000000000000026237
HQ05JP215CAD,000000,00000000000000026237
HQ05KFS17CAD,000000,00000000000000026237
HQ05PKY14CAD,000000,00000000000000026237
HQ05QLY11CAD,000000,00000000000000026237
HQ05QML13CAD,000000,00000000000000026237
HQ05QPF13CAD,000000,00000000000000026237
HQ05QS310CAD,000000,00000000000000026237
HQ05QTK19CAD,000000,00000000000000026237
HQ05QZR18CAD,000000,00000000000000026237
HQ05R2Z11CAD,000000,00000000000000026237
HQ05R6F14CAD,000000,00000000000000026237
HQ05R7711CAD,000000,00000000000000026237
HQ05R7L15CAD,000000,00000000000000026237
HQ05R8214CAD,000000,00000000000000026237
HQ05RLL14CAD,000000,00000000000000026237
HQ05RVR16CAD,000000,00000000000000026237
HQ05RZK14CAD,000000,00000000000000026237
HQ05RZN11CAD,000000,00000000000000026237
HQ05S0T11CAD,000000,00000000000000026237
HQ05S1L17CAD,000000,00000000000000026237
HQ05S4M10CAD,000000,00000000000000026237
HQ05S6M15CAD,000000,00000000000000026237
HQ05S9716CAD,000000,00000000000000026237
HQ05T1K17CAD,000000,00000000000000026237
HQ05VJC14CAD,000000,00000000000000026237
HQ05VQ912CAD,000000,00000000000000026237
HQ05W1213CAD,000000,00000000000000026237
HQ05Z9619CAD,000000,00000000000000026237
HQ05ZCM14CAD,000000,00000000000000026237
HQ05ZTQ13CAD,000000,00000000000000026237
HQ060NS10CAD,000000,00000000000000026237
HQ060XF12CAD,000000,00000000000000026237
HQ060XP11CAD,000000,00000000000000026237
HQ0627Y16CAD,000000,00000000000000026237
HQ062Q318CAD,000000,00000000000000026237
HQ0637715CAD,000000,00000000000000026237
HQ063CB19CAD,000000,00000000000000026237
HQ065C712CAD,000000,00000000000000026237
HQ069NB19CAD,000000,00000000000000026237
HQ06C3J11CAD,000000,00000000000000026237
HQ06CDS19CAD,000000,00000000000000026237
HQ06DG615CAD,000000,00000000000000026237
HQ06DHV15CAD,000000,00000000000000026237
HQ06H2711CAD,000000,00000000000000026237
HQ06JVR13CAD,000000,00000000000000026237
HQ06JWW15CAD,000000,00000000000000026237
HQ06K9118CAD,000000,00000000000000026237
HQ06KB410CAD,000000,00000000000000026237
HQ06L2Y16CAD,000000,00000000000000026237
HQ0761Z12CAD,000000,00000000000000026237
HQ07FQK13CAD,000000,00000000000000026237
HQ07FZM11CAD,000000,00000000000000026237
HQ07HK115CAD,000000,00000000000000026237
HQ07N8P19CAD,000000,00000000000000026237
HQ08LSS12CAD,000000,00000000000000026237
HQ08Y9G13CAD,000000,00000000000000026237
HQ0HNF612CAD,000000,00000000000000026237
HQ0HNR616CAD,000000,00000000000000026237
HQ0PZHQ15CAD,000000,00000000000000026237
HQ0QQPQ15CAD,000000,00000000000000026237
HQ0QV8R16CAD,000000,00000000000000026237
HQ0SN7Z14CAD,000000,00000000000000026237
HQ0T7WX17CAD,000000,00000000000000026237
HQ0TT6Z18CAD,000000,00000000000000026237
HQ0V6VD17CAD,000000,00000000000000026237
HQ12B4R19CAD,000000,00000000000000026237
HQ12B6S13CAD,000000,00000000000000026237
HQ12D3Q10CAD,000000,00000000000000026237
HQ13CY910CAD,000000,00000000000000026237
HQ14TM718CAD,000000,00000000000000026237
HQ15NN917CAD,000000,00000000000000026237
HQ1813R19CAD,000000,00000000000000026237
HQ1815112CAD,000000,00000000000000026237
HQ1817J19CAD,000000,00000000000000026237
HQ1BNK316CAD,000000,00000000000000026237
HQ1BWLV13CAD,000000,00000000000000026237
HQ1C1TQ14CAD,000000,00000000000000026237
HQ1CJ2C19CAD,000000,00000000000000026237
HQ1GMD718CAD,000000,00000000000000026237
X1000RY14CAD,000000,00000000000000026237
X1000SK17CAD,000000,00000000000000026237
X1000TL14CAD,000000,00000000000000026237
BR00135L1USD,000000,00000000000000026264
BR00136L0USD,000000,00000000000000026264
BR00142X6USD,000000,00000000000000026264
BR00142X6USD,120325,00000000000000026264
BR00143R8USD,000000,00000000000000026264
BR00144R7USD,000000,00000000000000026264
BR00145R6USD,000000,00000000000000026264
BR00148W2USD,000000,00000000000000026264
BR00152R6USD,000000,00000000000000026264
BR00153R5USD,000000,00000000000000026264
BR00157W0USD,000000,00000000000000026264
BR0017205USD,000000,00000000000000026264
BR00188R4USD,000000,00000000000000026264
BR00189X0USD,000000,00000000000000026264
BR00189X0USD,120325,00000000000000026264
BR00190X7USD,000000,00000000000000026264
BR00190X7USD,120325,00000000000000026264
H63496519CAD,000000,00000000000000026264
HQ00HQN13CAD,000000,00000000000000026264
HQ011XM14CAD,000000,00000000000000026264
HQ01B2C12CAD,000000,00000000000000026264
HQ01F5S14CAD,000000,00000000000000026264
HQ01YS617CAD,000000,00000000000000026264
HQ01Z5Q14CAD,000000,00000000000000026264
HQ022J818CAD,000000,00000000000000026264
HQ0247S10CAD,000000,00000000000000026264
HQ029T215CAD,000000,00000000000000026264
HQ02CCT19CAD,000000,00000000000000026264
HQ02CPF15CAD,000000,00000000000000026264
HQ02CYF16CAD,000000,00000000000000026264
HQ02GX713CAD,000000,00000000000000026264
HQ02GXW15CAD,000000,00000000000000026264
HQ04CLS16CAD,000000,00000000000000026264
HQ04NTT16CAD,000000,00000000000000026264
HQ04NTV13CAD,000000,00000000000000026264
HQ04Q9R19CAD,000000,00000000000000026264
HQ04T9015CAD,000000,00000000000000026264
HQ0532X19CAD,000000,00000000000000026264
HQ054JX11CAD,000000,00000000000000026264
HQ0573L16CAD,000000,00000000000000026264
HQ05D6R16CAD,000000,00000000000000026264
HQ05JP215CAD,000000,00000000000000026264
HQ05KFS17CAD,000000,00000000000000026264
HQ05PKY14CAD,000000,00000000000000026264
HQ05QML13CAD,000000,00000000000000026264
HQ05QPF13CAD,000000,00000000000000026264
HQ05R8214CAD,000000,00000000000000026264
HQ05RZK14CAD,000000,00000000000000026264
HQ05RZN11CAD,000000,00000000000000026264
HQ05S0S12CAD,000000,00000000000000026264
HQ05S4M10CAD,000000,00000000000000026264
HQ05S6M15CAD,000000,00000000000000026264
HQ05SDT13CAD,000000,00000000000000026264
HQ05T1K17CAD,000000,00000000000000026264
HQ05TDR14CAD,000000,00000000000000026264
HQ05VJC14CAD,000000,00000000000000026264
HQ05VQ912CAD,000000,00000000000000026264
HQ0601810CAD,000000,00000000000000026264
HQ0627Y16CAD,000000,00000000000000026264
HQ063CB19CAD,000000,00000000000000026264
HQ063DL16CAD,000000,00000000000000026264
HQ067L116CAD,000000,00000000000000026264
HQ06C3J11CAD,000000,00000000000000026264
HQ06CDS19CAD,000000,00000000000000026264
HQ06DHV15CAD,000000,00000000000000026264
HQ06JWW15CAD,000000,00000000000000026264
HQ06K9118CAD,000000,00000000000000026264
HQ06KB410CAD,000000,00000000000000026264
HQ06L2Y16CAD,000000,00000000000000026264
HQ06TJ117CAD,000000,00000000000000026264
HQ0761Z12CAD,000000,00000000000000026264
HQ07FQK13CAD,000000,00000000000000026264
HQ07FZM11CAD,000000,00000000000000026264
HQ07HK115CAD,000000,00000000000000026264
HQ07N8P19CAD,000000,00000000000000026264
HQ08LSS12CAD,000000,00000000000000026264
HQ08Y9G13CAD,000000,00000000000000026264
HQ0D9RH19CAD,000000,00000000000000026264
HQ0MD4K11CAD,000000,00000000000000026264
HQ0P90N14CAD,000000,00000000000000026264
HQ0P91Y10CAD,000000,00000000000000026264
HQ0P97915CAD,000000,00000000000000026264
HQ0PZHQ15CAD,000000,00000000000000026264
HQ0QV8R16CAD,000000,00000000000000026264
HQ0SN7Z14CAD,000000,00000000000000026264
HQ0TT6Z18CAD,000000,00000000000000026264
HQ0W2V310CAD,000000,00000000000000026264
HQ0YRV715CAD,000000,00000000000000026264
HQ1078810CAD,000000,00000000000000026264
HQ12B6S13CAD,000000,00000000000000026264
HQ12D3Q10CAD,000000,00000000000000026264
HQ1813810CAD,000000,00000000000000026264
HQ1813R19CAD,000000,00000000000000026264
HQ1815112CAD,000000,00000000000000026264
HQ1817J19CAD,000000,00000000000000026264
HQ1886B12CAD,000000,00000000000000026264
HQ1CNC114CAD,000000,00000000000000026264
HQ1CNHB12CAD,000000,00000000000000026264
HQ1D0GW14CAD,000000,00000000000000026264
HQ1DGP319CAD,000000,00000000000000026264
HQ1DQK111CAD,000000,00000000000000026264
BR00135L1USD,000000,00000000000000026255
BR00136L0USD,000000,00000000000000026255
BR00149W1USD,000000,00000000000000026255
BR00149W1USD,201120,00000000000000026255
BR00164L5USD,000000,00000000000000026255
HQ02NYC17CAD,000000,00000000000000026255
HQ0573L16CAD,000000,00000000000000026255
HQ05VJC14CAD,000000,00000000000000026255
HQ05Z9D11CAD,000000,00000000000000026255
HQ0627Y16CAD,000000,00000000000000026255
HQ063CB19CAD,000000,00000000000000026255
HQ067LG10CAD,000000,00000000000000026255
HQ06DHV15CAD,000000,00000000000000026255
HQ06K9118CAD,000000,00000000000000026255
HQ06KB410CAD,000000,00000000000000026255
HQ07FQK13CAD,000000,00000000000000026255
HQ07FZM11CAD,000000,00000000000000026255
HQ0PZHQ15CAD,000000,00000000000000026255
HQ0QV8R16CAD,000000,00000000000000026255
HQ0TT6Z18CAD,000000,00000000000000026255
HQ12B4R19CAD,000000,00000000000000026255
HQ1815112CAD,000000,00000000000000026255
X10008L10CAD,000000,00000000000000026255
BR00135L1USD,000000,00000000000000026277
BR00136L0USD,000000,00000000000000026277
BR00142X6USD,000000,00000000000000026277
BR00142X6USD,120325,00000000000000026277
BR00143R8USD,000000,00000000000000026277
BR00145R6USD,000000,00000000000000026277
BR00164L5USD,000000,00000000000000026277
BR00189X0USD,000000,00000000000000026277
BR00189X0USD,120325,00000000000000026277
BR00190X7USD,000000,00000000000000026277
BR00190X7USD,120325,00000000000000026277
HQ011XM14CAD,000000,00000000000000026277
HQ015R819CAD,000000,00000000000000026277
HQ01F5S14CAD,000000,00000000000000026277
HQ01Q1912CAD,000000,00000000000000026277
HQ01YS617CAD,000000,00000000000000026277
HQ02GXW15CAD,000000,00000000000000026277
HQ02NYC17CAD,000000,00000000000000026277
HQ04CLS16CAD,000000,00000000000000026277
HQ04NTV13CAD,000000,00000000000000026277
HQ04Q9R19CAD,000000,00000000000000026277
HQ051B611CAD,000000,00000000000000026277
HQ0532X19CAD,000000,00000000000000026277
HQ0573L16CAD,000000,00000000000000026277
HQ05D6R16CAD,000000,00000000000000026277
HQ05FJ510CAD,000000,00000000000000026277
HQ05PKY14CAD,000000,00000000000000026277
HQ05QPF13CAD,000000,00000000000000026277
HQ05RVR16CAD,000000,00000000000000026277
HQ05RZK14CAD,000000,00000000000000026277
HQ05S6M15CAD,000000,00000000000000026277
HQ05VJC14CAD,000000,00000000000000026277
HQ060NS10CAD,000000,00000000000000026277
HQ0627Y16CAD,000000,00000000000000026277
HQ063CB19CAD,000000,00000000000000026277
HQ06C3J11CAD,000000,00000000000000026277
HQ06CDS19CAD,000000,00000000000000026277
HQ06JWW15CAD,000000,00000000000000026277
HQ06K9118CAD,000000,00000000000000026277
HQ06KB410CAD,000000,00000000000000026277
HQ06L2Y16CAD,000000,00000000000000026277
HQ07FQK13CAD,000000,00000000000000026277
HQ07FZM11CAD,000000,00000000000000026277
HQ08LSS12CAD,000000,00000000000000026277
HQ08Y9G13CAD,000000,00000000000000026277
HQ0QV8R16CAD,000000,00000000000000026277
HQ0RY1916CAD,000000,00000000000000026277
HQ0RY2211CAD,000000,00000000000000026277
HQ0RY2617CAD,000000,00000000000000026277
HQ0RY3Y14CAD,000000,00000000000000026277
HQ0SN7Z14CAD,000000,00000000000000026277
HQ13CY910CAD,000000,00000000000000026277
HQ1813810CAD,000000,00000000000000026277
HQ1817J19CAD,000000,00000000000000026277
HQ1B8RV17CAD,000000,00000000000000026277
HQ1CJ2C19CAD,000000,00000000000000026277
HQ1DQK111CAD,000000,00000000000000026277"""

# =============================================================================
# WRITE-OFF / SUSPENSE ACCOUNTS (Destination accounts for write-offs)
# =============================================================================

WRITEOFF_ACCOUNTS = [
    ("HQ0C7XCK3CAD", "201030"),
    ("HM93593K8CAD", "201030"),
    ("WB7218549CAD", "201030"),
    ("H19930702CAD", "201010"),
    ("WB7658603CAD", "201060"),
    ("HQ11SKM04CAD", "201010"),
    ("WK06HDB00CAD", "201010"),
    ("H516808K7CAD", "201030"),
    ("H521649K0CAD", "201030"),
    ("HQ1FJ3B11CAD", "201010"),
    ("W67452909CAD", "201010"),
    ("WK061B3K6CAD", "201030"),
    ("HQ1VB5G06CAD", "201010"),
    ("HQ1W8R0K3CAD", "201030"),
    ("W641704K1CAD", "201030"),
    ("HP8175918CAD", "201010"),
    ("WK05NGF04CAD", "201060"),
    ("WK05833K9CAD", "201030"),
    ("HQ1GG6405CAD", "201010"),
    ("HQ1466NK8CAD", "201030"),
]

# =============================================================================
# CONSTANTS
# =============================================================================

JIRA_ID = "DCOE-TEST"
POSITION = "CP"
CURRENCY = "STAT"
LINE_DESCRIPTION = "BULK WRITEOFF TEST - NOT FOR PRODUCTION"
TRANS_SUBCODE = ""
FX_RATE = "1"
BUSINESS_UNIT = "DISC"
BV_DELTA = "0"
RELATED_ASSET_ID = ""
COMMISSION = "0"
REFERENCE_VALUE = ""
REFERENCE_TYPE = "NONE"
EXTERNAL_SOURCE = ""

CSV_HEADERS = [
    "ENTRY_NUM", "JIRA_ID", "ASSET_ID", "POSITION", "ACCOUNTING_DATE",
    "NATURAL_ACCT", "SUB_ACCT", "TRANS_CODE", "CURRENCY", "ENTERED_DR",
    "ENTERED_CR", "LINE_DESCRIPTION", "TRANS_SUBCODE", "FX_RATE",
    "BUSINESS_UNIT", "BV_DELTA_DR", "BV_DELTA_CR", "RELATED_ASSET_ID",
    "COMMISSION", "REFERENCE_VALUE", "REFERENCE_TYPE", "EXTERNAL_SOURCE"
]


def parse_raw_data() -> Dict[str, List[Tuple[str, str]]]:
    """
    Parse raw data and group by ASSET_ID.
    Returns: {asset_id: [(sub_acct, natural_acct), ...]}
    """
    assets_to_accounts: Dict[str, List[Tuple[str, str]]] = defaultdict(list)

    for line in RAW_DATA.strip().split('\n'):
        parts = line.split(',')
        if len(parts) >= 3:
            sub_acct, natural_acct, asset_id = parts[0], parts[1], parts[2]
            assets_to_accounts[asset_id].append((sub_acct, natural_acct))

    # Only keep assets with at least 2 accounts (for pairing)
    return {k: v for k, v in assets_to_accounts.items() if len(v) >= 2}


def generate_random_amount() -> Decimal:
    """Generate a random tiny amount (8-10 decimal places)."""
    mantissa = random.randint(1, 9999)
    exponent = random.randint(8, 10)
    return Decimal(mantissa) / Decimal(10 ** exponent)


def format_amount(amount: Decimal) -> str:
    """Format amount with 10 decimal places."""
    return f"{amount:.10f}"


def generate_entry_pair(
    entry_num: int,
    accounting_date: str,
    asset_id: str,
    source: Tuple[str, str],
    dest: Tuple[str, str],
    unbalanced: bool = False
) -> List[List[str]]:
    """
    Generate a balanced (or unbalanced) pair of journal lines for one entry.
    """
    source_sub_acct, source_natural_acct = source
    dest_sub_acct, dest_natural_acct = dest

    dr_amount = generate_random_amount()

    if unbalanced:
        # Generate a different CR amount (off by a tiny bit)
        cr_amount = dr_amount + Decimal("0.0000000001")
    else:
        cr_amount = dr_amount

    dr_str = format_amount(dr_amount)
    cr_str = format_amount(cr_amount)

    # Line 1: DEL (Delivery) - Debit side
    del_line = [
        str(entry_num),
        JIRA_ID,
        asset_id,
        POSITION,
        accounting_date,
        source_natural_acct,
        source_sub_acct,
        "DEL",
        CURRENCY,
        dr_str,   # ENTERED_DR
        "",       # ENTERED_CR (empty)
        LINE_DESCRIPTION,
        TRANS_SUBCODE,
        FX_RATE,
        BUSINESS_UNIT,
        BV_DELTA,
        BV_DELTA,
        RELATED_ASSET_ID,
        COMMISSION,
        REFERENCE_VALUE,
        REFERENCE_TYPE,
        EXTERNAL_SOURCE
    ]

    # Line 2: REC (Receipt) - Credit side
    rec_line = [
        str(entry_num),
        JIRA_ID,
        asset_id,
        POSITION,
        accounting_date,
        dest_natural_acct,
        dest_sub_acct,
        "REC",
        CURRENCY,
        "",       # ENTERED_DR (empty)
        cr_str,   # ENTERED_CR
        LINE_DESCRIPTION,
        TRANS_SUBCODE,
        FX_RATE,
        BUSINESS_UNIT,
        BV_DELTA,
        BV_DELTA,
        RELATED_ASSET_ID,
        COMMISSION,
        REFERENCE_VALUE,
        REFERENCE_TYPE,
        EXTERNAL_SOURCE
    ]

    return [del_line, rec_line]


def generate_csv(
    num_entries: int,
    output_path: str,
    accounting_date: str = None,
    unbalanced: bool = False,
    use_writeoff_accounts: bool = True
) -> None:
    """Generate the bulk journal CSV file.

    Args:
        num_entries: Number of journal entries to generate
        output_path: Path to output CSV file
        accounting_date: Accounting date (YYYY-MM-DD), defaults to today
        unbalanced: If True, generate entries where DR != CR (for error testing)
        use_writeoff_accounts: If True, use dedicated write-off accounts as destination
                               If False, use random account pairs from same asset
    """

    assets_to_accounts = parse_raw_data()

    if not assets_to_accounts:
        raise ValueError("No valid asset/account pairs found!")

    if accounting_date is None:
        accounting_date = date.today().isoformat()

    # Build list of valid (asset_id, accounts) pairs
    asset_list = list(assets_to_accounts.items())

    print(f"Generating {num_entries} entries ({num_entries * 2} rows)...")
    print(f"Unique assets: {len(asset_list)}")
    print(f"Total source account combinations: {sum(len(v) for v in assets_to_accounts.values())}")
    print(f"Write-off destination accounts: {len(WRITEOFF_ACCOUNTS)}")
    print(f"Accounting date: {accounting_date}")
    print(f"Unbalanced mode: {unbalanced}")
    print(f"Use write-off accounts: {use_writeoff_accounts}")

    with open(output_path, 'w', newline='') as f:
        writer = csv.writer(f)
        writer.writerow(CSV_HEADERS)

        for entry_num in range(1, num_entries + 1):
            # Pick random asset and source account
            asset_id, accounts = random.choice(asset_list)
            source = random.choice(accounts)

            if use_writeoff_accounts:
                # Use dedicated write-off account as destination
                dest = random.choice(WRITEOFF_ACCOUNTS)
            else:
                # Pick a different account for the same asset
                other_accounts = [a for a in accounts if a != source]
                if other_accounts:
                    dest = random.choice(other_accounts)
                else:
                    # Fallback to write-off account if only one account for this asset
                    dest = random.choice(WRITEOFF_ACCOUNTS)

            # Generate balanced/unbalanced pair
            rows = generate_entry_pair(
                entry_num,
                accounting_date,
                asset_id,
                source,
                dest,
                unbalanced=unbalanced
            )
            writer.writerows(rows)

            # Progress indicator
            if entry_num % 50000 == 0:
                print(f"  Generated {entry_num} entries...")

    print(f"Done! Output: {output_path}")

    # Print file size
    import os
    size_mb = os.path.getsize(output_path) / (1024 * 1024)
    print(f"File size: {size_mb:.2f} MB")


def main():
    parser = argparse.ArgumentParser(description="Generate bulk journal test CSV")
    parser.add_argument("--entries", type=int, default=10000,
                        help="Number of journal entries (default: 10000)")
    parser.add_argument("--output", type=str, default="bulk_writeoff_test.csv",
                        help="Output file path")
    parser.add_argument("--date", type=str, default=None,
                        help="Accounting date (YYYY-MM-DD), defaults to today")
    parser.add_argument("--unbalanced", action="store_true",
                        help="Generate unbalanced entries (DR != CR) for error testing")
    parser.add_argument("--no-writeoff-accounts", action="store_true",
                        help="Don't use dedicated write-off accounts; pair accounts from same asset instead")

    args = parser.parse_args()
    generate_csv(
        args.entries,
        args.output,
        args.date,
        args.unbalanced,
        use_writeoff_accounts=not args.no_writeoff_accounts
    )


if __name__ == "__main__":
    main()
